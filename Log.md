# Log.md — 開發日誌

---

## UI 重大更新 (2026-02-18)

### iOS Dark Mode 與緊湊佈局 (commit `d5bf056`, `8ee6630`)

1. **視覺風格更新**：
   - 全面採用 iOS Dark Mode 設計語言：純黑 (`#000000`) 與深灰 (`#1C1C1E`) 背景。
   - 字體改用 SF Pro 風格，強調色為 iOS 系統藍 (`#0A84FF`)。
   - 頂部與導覽列加入磨砂玻璃效果 (`backdrop-filter: blur`)。
   - 圓角與元件樣式現代化。

2. **緊湊度調整**：
   - 縮減 Header (`44px`) 與 Navigation Bar (`40px`) 高度。
   - 縮小字體 (`13px`) 與 Slot 寬度 (`24px`)，提升單頁資訊密度。

3. **導航邏輯改良**：
   - **2-Day View**：改為 Sliding Window 模式，每次點擊下一頁只前進 1 天（例如：週一/二 → 週二/三），提供更連續的時間感。
   - **週末隱藏**：主畫面完全隱藏週六與週日，導航會自動跳過週末。

4. **新 App Icon**：
   - 設計極簡高科技感 Icon（黑底霓虹藍幾何圖形）。
   - 以 SVG Data URI 直接嵌入 `index.html`，無需額外檔案。

---

## 資料問題與修正

### CXMS 班表 AJAX 動態載入（根本原因）

**發現**：CXMS 所有診所的班表透過 AJAX 動態載入，舊爬蟲只抓靜態 HTML，完全抓不到班表。導致初次轉錄全靠人工，存在系統性錯誤。

**後續對策**：爬蟲需改用 Selenium 渲染，或直接找各診所的 AJAX 端點（路徑因診所而異）。

---

### 排班衝突修正（commit `aa7fa74`）

發現 10 筆衝突（同一醫師同時出現在兩家診所）：

| 醫師 | 診所 A | 診所 B | 結論 |
|------|--------|--------|------|
| 蔡馥如 | c03 富新骨科 | c08 正陽骨科 | 兩家都有，但正陽週四早診是錯誤轉錄 |
| 廖芝晨 | c07 土城杏光 | c19 得揚診所 | 兩家都有，但土城杏光的班表被錯誤複製 |
| 悅滿意江 | c13 悅滿意永和 | c14 悅滿意新店 | 同一人兩院區，非錯誤 ✅ |

**修正**：
- c08 正陽：刪除週一～週三蔡馥如（`zy_m1_2`, `zy_m2_2`, `zy_m3_2`, `zy_a5`, `zy_e2`, `zy_e3`）
- c07 土城杏光：刪除 5 筆錯誤廖芝晨，補入劉侑真/莊凱如/李毅康正確資料

---

### 資料稽核與快照補齊（2026-02-18）

**稽核結論**：

| 來源 | 快照 | 資料正確性 |
|------|------|-----------|
| CXMS 8 家 | ✅ 已補（snapshots/web/c02-c07/c19/c20） | ✅ 今日重新對過 |
| FB 5 家 | ✅ 已補全尺寸截圖（c09/c22 重拍） | ✅ 今日重新對過 |
| 官方網站（c10/c11/c15/c16/c18/c21） | ✅ 已補（c10/c11 維力官網） | ✅ 今日重新對過 |
| 圖片（c08/c13/c14） | ⚠️ 使用者提供圖片，已人工驗證 | ✅ 今日修正 |

**資料修正（239 → 258 sessions）**：

| 診所 | 問題 | 修正 |
|------|------|------|
| c09 健維骨科 | 全部標為韓文江，漏掉林承翰 | 重建 14 筆，正確分配韓/林 |
| c22 順安復健科 | 醫師名「滕學澍」→「滕學淵」，漏 2/28 | 更名 + 補 2/28 早診 |
| c14 悅滿意新店 | 大量錯誤（圖片未正確轉錄） | 依使用者提供圖片全部重建 14 筆 |
| c13 悅滿意永和 | 大量漏診（圖片未正確轉錄） | 依使用者提供圖片全部重建 11 筆 |
| c10 板橋維力 | 醫師名「高逢駿」→「高達駿」（5 筆） | 批次更名 |

---

### CXMS 診所系統性修正（commit `b3b8489`）

用瀏覽器逐一爬取 8 家 CXMS 診所實際班表，對比後批次修正（256 → 239 sessions）：

| 診所 | 問題摘要 |
|------|---------|
| c02 維恩 | 週二早診醫師錯、週一下午漏一診、週三早診漏 |
| c03 富新 | 週三早診/下午醫師對調，週四五空白資料 |
| c04 得安 | 週一/二/三多筆醫師錯，週四五空白資料 |
| c05 昌惟 | 週一/二/三晚上醫師錯、週二下午漏診，週四五空白 |
| c06 昌禾 | 週二下午/晚上、週三早診/下午醫師錯，週四五空白 |
| c07 土城杏光 | 週四五空白資料 |
| c08 正陽 | 週四早診蔡馥如（`zy_m4_2`）刪除（commit `e797329`） |
| c19 得揚 | 驗證正確 ✅ |
| c20 力康 | 週二/三多筆醫師錯及漏診，週四五空白 |

**蔡馥如正確班表**：富新（週一早、週三晚）、正陽（週四下午、週四晚）

---

## 功能 Bug 修正

### 設定頁 Toggle 三態邏輯 Bug

**問題**：醫師顯示/隱藏 toggle 第二次點擊行為錯誤。

**解法**：三態邏輯：
1. 無 override → 點擊 → 寫入 `'hide'`
2. 有 `'hide'` → 點擊 → 刪除 key（回到基礎狀態）
3. 基礎狀態本來就隱藏 → 點擊 → 寫入 `'show'`

---

## 資料爬取限制

| 來源 | 狀態 | 說明 |
|------|------|------|
| CXMS 網站 | ⚠️ 需 JS 渲染 | 班表是 AJAX 載入，靜態爬蟲抓不到 |
| Facebook | ❌ 需登入 | 改為手動截圖 + `--add-screenshot` |
| 其他網站 | ✅ 可直接爬 | 無 Cloudflare，無需 JS |

---

## 已知限制（不打算修）

- `<select>` 的 `onchange` 在 headless browser 中不觸發（只影響自動化測試，不影響真實使用者）
- 單一 HTML 檔案，不拆分模組
- 不加 build pipeline
- 不做使用者帳號

---

### SOP 建立與流程標準化（commit `3c58289`）

**建立 `SOP.md` v1.2**：
- 定義四大類資料來源（CXMS、FB、官網、圖片）的標準更新程序
- 規範更新頻率：CXMS 每週日、FB/官網月班表每月底
- 規範衝突處理：同名必同人，跨院不衝突，同天同時段才算衝突
- 規範 OCR 流程：先問使用者 → 記錄到 `source_note` & `ocr_corrections.md`

**文件更新**：
- 新增 `scraper/ocr_corrections.md`
- 建立 c13/c14 的 `schedule_transcription.md`
- 修正 `schedules.json` 中 c02/c09/c10/c13/c14/c22 的資料錯誤與缺漏

---

## 待辦事項

### 資料維護
- [x] 補齊所有診所的快照（FB 全尺寸、CXMS、官網）
- [x] 修正 `schedules.json` 與快照不符之處
- [ ] 下週日（2/22）執行第一次依據 SOP v1.2 的例行更新

### 功能改進（未來考慮）
- [ ] 爬蟲改用 Selenium 自動化更新 CXMS 班表（目前 SOP 為手動/瀏覽器截圖）
- [ ] 加入 Service Worker 支援離線瀏覽
- [ ] 週視圖加入「本週/下週」快速跳轉
- [ ] 底部資訊卡加入診所電話/地址
- [ ] 多語言支援（目前只有繁體中文）

### 已知限制（不打算修）
- 單一 HTML 檔案，不拆分模組（保持簡單，方便直接編輯）
- 不加 build pipeline（維護成本太高）
- 不做使用者帳號（私人工具，不需要）
