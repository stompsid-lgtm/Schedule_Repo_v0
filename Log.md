# Log.md — 開發日誌

---

## 資料問題與修正

### CXMS 班表 AJAX 動態載入（根本原因）

**發現**：CXMS 所有診所的班表透過 AJAX 動態載入，舊爬蟲只抓靜態 HTML，完全抓不到班表。導致初次轉錄全靠人工，存在系統性錯誤。

**後續對策**：爬蟲需改用 Selenium 渲染，或直接找各診所的 AJAX 端點（路徑因診所而異）。

---

### 排班衝突修正（commit `aa7fa74`）

發現 10 筆衝突（同一醫師同時出現在兩家診所）：

| 醫師 | 診所 A | 診所 B | 結論 |
|------|--------|--------|------|
| 蔡馥如 | c03 富新骨科 | c08 正陽骨科 | 兩家都有，但正陽週四早診是錯誤轉錄 |
| 廖芝晨 | c07 土城杏光 | c19 得揚診所 | 兩家都有，但土城杏光的班表被錯誤複製 |
| 悅滿意江 | c13 悅滿意永和 | c14 悅滿意新店 | 同一人兩院區，非錯誤 ✅ |

**修正**：
- c08 正陽：刪除週一～週三蔡馥如（`zy_m1_2`, `zy_m2_2`, `zy_m3_2`, `zy_a5`, `zy_e2`, `zy_e3`）
- c07 土城杏光：刪除 5 筆錯誤廖芝晨，補入劉侑真/莊凱如/李毅康正確資料

---

### 資料稽核與快照補齊（2026-02-18）

**稽核結論**：

| 來源 | 快照 | 資料正確性 |
|------|------|-----------|
| CXMS 8 家 | ✅ 已補（snapshots/web/c02-c07/c19/c20） | ✅ 今日重新對過 |
| FB 5 家 | ✅ 已補全尺寸截圖（c09/c22 重拍） | ✅ 今日重新對過 |
| 官方網站（c10/c11/c15/c16/c18/c21） | ✅ 已補（c10/c11 維力官網） | ✅ 今日重新對過 |
| 圖片（c08/c13/c14） | ⚠️ 使用者提供圖片，已人工驗證 | ✅ 今日修正 |

**資料修正（239 → 258 sessions）**：

| 診所 | 問題 | 修正 |
|------|------|------|
| c09 健維骨科 | 全部標為韓文江，漏掉林承翰 | 重建 14 筆，正確分配韓/林 |
| c22 順安復健科 | 醫師名「滕學澍」→「滕學淵」，漏 2/28 | 更名 + 補 2/28 早診 |
| c14 悅滿意新店 | 大量錯誤（圖片未正確轉錄） | 依使用者提供圖片全部重建 14 筆 |
| c13 悅滿意永和 | 大量漏診（圖片未正確轉錄） | 依使用者提供圖片全部重建 11 筆 |
| c10 板橋維力 | 醫師名「高逢駿」→「高達駿」（5 筆） | 批次更名 |

---

### CXMS 診所系統性修正（commit `b3b8489`）

用瀏覽器逐一爬取 8 家 CXMS 診所實際班表，對比後批次修正（256 → 239 sessions）：

| 診所 | 問題摘要 |
|------|---------|
| c02 維恩 | 週二早診醫師錯、週一下午漏一診、週三早診漏 |
| c03 富新 | 週三早診/下午醫師對調，週四五空白資料 |
| c04 得安 | 週一/二/三多筆醫師錯，週四五空白資料 |
| c05 昌惟 | 週一/二/三晚上醫師錯、週二下午漏診，週四五空白 |
| c06 昌禾 | 週二下午/晚上、週三早診/下午醫師錯，週四五空白 |
| c07 土城杏光 | 週四五空白資料 |
| c08 正陽 | 週四早診蔡馥如（`zy_m4_2`）刪除（commit `e797329`） |
| c19 得揚 | 驗證正確 ✅ |
| c20 力康 | 週二/三多筆醫師錯及漏診，週四五空白 |

**蔡馥如正確班表**：富新（週一早、週三晚）、正陽（週四下午、週四晚）

---

## 功能 Bug 修正

### 設定頁 Toggle 三態邏輯 Bug

**問題**：醫師顯示/隱藏 toggle 第二次點擊行為錯誤。

**解法**：三態邏輯：
1. 無 override → 點擊 → 寫入 `'hide'`
2. 有 `'hide'` → 點擊 → 刪除 key（回到基礎狀態）
3. 基礎狀態本來就隱藏 → 點擊 → 寫入 `'show'`

---

## 資料爬取限制

| 來源 | 狀態 | 說明 |
|------|------|------|
| CXMS 網站 | ⚠️ 需 JS 渲染 | 班表是 AJAX 載入，靜態爬蟲抓不到 |
| Facebook | ❌ 需登入 | 改為手動截圖 + `--add-screenshot` |
| 其他網站 | ✅ 可直接爬 | 無 Cloudflare，無需 JS |

---

## 已知限制（不打算修）

- `<select>` 的 `onchange` 在 headless browser 中不觸發（只影響自動化測試，不影響真實使用者）
- 單一 HTML 檔案，不拆分模組
- 不加 build pipeline
- 不做使用者帳號

---

## 待辦事項

### 資料維護
- [ ] 每週更新 `schedules.json`（需用瀏覽器爬取 CXMS AJAX 資料）
- [ ] 確認各診所白/黑名單是否需要調整
- [ ] 圖片診所（正陽 c08、悅滿意 c13/c14）每 6 個月複查一次

### 功能改進（未來考慮）
- [ ] 爬蟲改用 Selenium 自動化更新 CXMS 班表
- [ ] 加入 Service Worker 支援離線瀏覽
- [ ] 週視圖加入「本週/下週」快速跳轉
- [ ] 底部資訊卡加入診所電話/地址
- [ ] 多語言支援（目前只有繁體中文）

### 已知限制（不打算修）
- 單一 HTML 檔案，不拆分模組（保持簡單，方便直接編輯）
- 不加 build pipeline（維護成本太高）
- 不做使用者帳號（私人工具，不需要）
