# Log.md — 開發日誌

## 已解決的問題

### [設定頁] Toggle 三態邏輯 Bug（2026-02-18）
**問題**：設定頁的醫師顯示/隱藏 toggle，第二次點擊時行為錯誤——應該「清除 override 回到基礎狀態」，但實際上又再次寫入 override。

**嘗試過**：
- 直接用 `overrides[key] = 'hide'` toggle → 失敗，因為沒有處理「清除」的第三態

**解法**：改成三態邏輯：
1. 無 override（基礎狀態）→ 點擊 → 寫入 `'hide'`（手動隱藏）
2. 有 `'hide'` override → 點擊 → 刪除 key（清除 override，回到基礎）
3. 基礎狀態若本來就是隱藏（黑名單）→ 點擊 → 寫入 `'show'`（強制顯示）

---

### [資料爬取] Facebook 反爬蟲（2026-02-18）
**問題**：部分 FB 診所貼文需要登入才能看到，`fb_snapshot.py` 截圖只拍到登入頁。

**嘗試過**：
- 直接用 Selenium 無頭模式截圖 → 失敗，FB 偵測到 bot 並跳出登入頁

**現行方案**：改為「手動截圖 + `--add-screenshot` 加入」，不再嘗試自動登入 FB。

---

### [資料爬取] CXMS 網站反爬蟲偵測（2026-02-18）
**結果**：8/8 家 CXMS 診所全部可直接爬取，無 Cloudflare，無需 JS 渲染。可放心用 `requests` 直接抓 HTML。

---

## 當前卡關的問題

### [診所篩選] `<select>` 的 `onchange` 在 browser subagent 中不觸發
**現象**：用 browser subagent 測試時，用 ArrowDown + Enter 選擇 `<select>` 選項，`onchange` 事件沒有觸發，filter bar 沒出現。

**影響**：只影響自動化測試，實際在手機/瀏覽器上用手點選是正常的。

**暫不處理**：這是 headless browser 的限制，不影響真實使用者。

---

## 待辦事項

### 資料維護
- [ ] 每週更新 `schedules.json`（參考 `scraper/README.md` 流程）
- [ ] 確認各診所白/黑名單是否需要調整
- [ ] 圖片診所（正陽 c08、悅滿意 c13/c14）每 6 個月複查一次

### 功能改進（未來考慮）
- [ ] 加入 Service Worker 支援離線瀏覽（目前每次開 App 都需要網路）
- [ ] 週視圖加入「本週/下週」快速跳轉
- [ ] 底部資訊卡加入診所電話/地址
- [ ] 多語言支援（目前只有繁體中文）

### 已知限制（不打算修）
- 單一 HTML 檔案，不拆分模組（保持簡單，方便直接編輯）
- 不加 build pipeline（維護成本太高）
- 不做使用者帳號（私人工具，不需要）
